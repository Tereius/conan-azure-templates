parameters:
  conanEnv: {}

steps:
- checkout: self
  path: sourceCode
  lfs: true
- checkout: templates
  path: helper
- task: UsePythonVersion@0
  displayName: 'Setup python'
  inputs:
    versionSpec: "3.x"
    addToPath: true
    architecture: "x64"

- script: |
    pip install --upgrade pip
    pip install conan==2.3.1
  displayName: 'Install conan'
  
- task: PythonScript@0
  displayName: 'Upload recipe'
  timeoutInMinutes: 15
  env: ${{ parameters.conanEnv }}
  inputs:
      scriptSource: filePath
      scriptPath: $(Pipeline.Workspace)/helper/upload.py
      workingDirectory: $(Pipeline.Workspace)/sourceCode

- task: PublishPipelineArtifact@1
  displayName: 'Publish conan_upload_info artifact'
  inputs:
    targetPath: $(Pipeline.Workspace)/sourceCode/conan_upload_info.json
    artifactName: conan_upload_info
